# ТЕХНИЧЕСКОЕ ЗАДАНИЕ: GENAI-9 (Personalized Final Edition)

**Тема:** Интеллектуальная система найма и прогнозирования удержания промышленных рабочих («Blue-Collar Retention AI»).
**Команда:**
1.  **Андрей Червов** (AI Engineer & Data Integrator)
2.  **Тихон Сотников** (System Architect & Backend)
3.  **Арсений Сизов** (ML Engineer & Frontend)

**Цель:** MVP системы, которая принимает аудио/текст интервью и выдает не только оценку навыков, но и **Retention Score** (вероятность, что сотрудник не уволится через 3 месяца), основываясь на совместимости бытовых условий.

---

## 1. АРХИТЕКТУРА И ПОТОКИ ДАННЫХ

Система функционирует как монолитное приложение с четким разделением слоев.

1.  **Input Layer:** Аудиофайл интервью или текст диалога.
2.  **Processing Layer (AI):** Преобразование речи в текст (STT) $\rightarrow$ Извлечение фактов LLM (Extraction) $\rightarrow$ Нормализация.
3.  **Intelligence Layer (ML):** Применение ML-модели к нормализованным данным $\rightarrow$ Расчет Retention Score + Интерпретация (почему риск высок?).
4.  **Storage & API:** Сохранение результатов, выдача данных фронтенду.
5.  **Presentation Layer:** Веб-интерфейс для рекрутера.

---

## 2. КОНТРАКТ ДАННЫХ (Shared Core)

*Критический этап. Файлы создаются в День 1. Ответственный за инициализацию: Андрей Червов.*

**Файл:** `app/core/enums.py`
Гарантирует, что LLM (Андрей), ML (Арсений) и UI (Арсений) используют одни константы.
```python
from enum import IntEnum

class ShiftPreference(IntEnum):
    DAY_ONLY = 0
    NIGHT_ONLY = 1
    ANY = 2

class RiskLevel(IntEnum):
    LOW = 0
    MEDIUM = 1
    HIGH = 2
```

**Файл:** `app/core/schemas.py`
Pydantic-модели для валидации.
```python
class CandidateVector(BaseModel):
    """Данные для ML-модели (Стык зон Андрея и Арсения)"""
    skills_verified_count: int
    years_experience: float
    commute_time_minutes: int
    shift_preference: ShiftPreference
    salary_expectation: int
    has_certifications: bool

class CandidateResult(BaseModel):
    """Полный ответ системы (Стык зон Тихона и Арсения)"""
    id: str
    full_name: str
    raw_summary: str            # Краткое резюме от LLM
    vector: CandidateVector     # Чистые данные
    retention_score: float      # 0.0 - 1.0
    risk_factors: List[str]     # Объяснение ("Живет слишком далеко")
```

---

## 3. РАСПРЕДЕЛЕНИЕ РОЛЕЙ И ЗАДАЧ

### АНДРЕЙ ЧЕРВОВ: AI Engineer & Data Integrator
**Ответственность:** Превращение хаоса (естественный язык) в порядок (JSON).

1.  **STT Pipeline:**
    *   Реализовать транскрибацию.
    *   *Стек:* `OpenAI Whisper API` (приоритет) или `faster-whisper`.
2.  **LLM Extraction & Normalization:**
    *   Написать системный промпт, принимающий `enums.py` как контекст.
    *   Реализовать **Json Mode** (гарантированный JSON на выходе LLM).
    *   Валидация: если кандидат сказал "минут 40-50 ехать", код Андрея превращает это в `45` (int).
3.  **Caching:**
    *   Реализовать кэширование результатов анализа по хэшу текста (чтобы не гонять LLM на одних и тех же тестах).

### ТИХОН СОТНИКОВ: System Architect & Backend
**Ответственность:** Сборка, База Данных, API и стабильность.

1.  **FastAPI Skeleton:**
    *   `POST /analyze`: Принимает файл $\rightarrow$ вызывает модуль Андрея $\rightarrow$ вызывает модуль Арсения $\rightarrow$ пишет в БД $\rightarrow$ возвращает JSON.
    *   `GET /history`: Список всех кандидатов.
2.  **Database:**
    *   SQLite (для простоты) или PostgreSQL.
    *   ORM: SQLAlchemy / SQLModel.
3.  **Dependency Injection:**
    *   Настроить импорт модулей `ai_engine` и `ml_engine` в `main.py`. Обеспечить, чтобы код Андрея и Арсения запускался в едином контексте.
4.  **Error Handling:**
    *   Обработка ситуаций, когда LLM недоступна или БД заблокирована.

### АРСЕНИЙ СИЗОВ: ML Engineer & Frontend
**Ответственность:** "Мозг" (ML) и "Лицо" (UI).

1.  **Synthetic Data Generator (Rule-Based):**
    *   Написать скрипт генерации `train.csv` (1000 строк).
    *   **Важно:** Использовать жесткие правила. *Пример:* Если `Commute > 90 мин`, то `Retention = 0`.
2.  **ML Model & Interpretability:**
    *   Обучить CatBoostClassifier / RandomForest.
    *   Реализовать функцию `explain_prediction(vector)`, возвращающую топ-факторы риска.
3.  **Streamlit UI:**
    *   Дашборд рекрутера.
    *   Кнопки-пресеты ("Загрузить идеального", "Загрузить проблемного") для демонстрации.
    *   Визуализация индикаторов риска.

---

## 4. СТРУКТУРА РЕПОЗИТОРИЯ

```text
genai-project/
├── data/
│   ├── train_dataset.csv       # Арсений (генерация)
│   └── demo_audio/             # Общее (файлы для защиты)
├── app/
│   ├── core/                   # ОБЩЕЕ (Contract)
│   │   ├── config.py
│   │   ├── enums.py            # Андрей (инициализация)
│   │   └── schemas.py          # Андрей (инициализация)
│   ├── ai/                     # АНДРЕЙ
│   │   ├── extractor.py        # Логика LLM
│   │   └── transcriber.py      # Логика STT
│   ├── ml/                     # АРСЕНИЙ
│   │   ├── generator.py        # Скрипт генерации данных
│   │   ├── model.pkl           # Бинарник модели
│   │   └── predictor.py        # Обертка для инференса
│   ├── api/                    # ТИХОН
│   │   ├── database.py
│   │   ├── models_db.py        # Таблицы БД
│   │   └── routes.py           # Эндпоинты
│   └── ui/                     # АРСЕНИЙ
│       └── dashboard.py        # Streamlit app
├── main.py                     # ТИХОН (Точка входа)
├── requirements.txt
└── docker-compose.yml
```

---

## 5. ПЛАН-ГРАФИК (SPRINT)

### День 1: Контракты и Данные
*   **Синхронизация:** Вся команда утверждает поля в `CandidateVector`.
*   **Арсений:** Пишет генератор, создает `train.csv`, обучает первую версию модели.
*   **Андрей:** Настраивает LLM промпт под утвержденную схему.
*   **Тихон:** Создает репозиторий, настраивает FastAPI и Docker окружение.

### День 2: Разработка Ядра
*   **Андрей:** Реализует парсинг текста и STT. Пишет тесты на "грязных" данных (сленг, ошибки).
*   **Арсений:** Создает UI на Streamlit. Делает заглушки запросов к API.
*   **Тихон:** Подключает Базу Данных. Пишет "клеящий" код, который берет результат Андрея, передает Арсению и сохраняет в БД.

### День 3: Интеграция и Полировка
*   **Общее:** Сквозной тест (End-to-End). Файл $\rightarrow$ API $\rightarrow$ UI.
*   **Арсений:** Добавляет интерпретацию ("Почему риск высокий?") в UI.
*   **Андрей:** Тюнит промпты для повышения стабильности JSON.
*   **Тихон:** Проверяет отказоустойчивость API.

---

## 6. СЦЕНАРИИ ДЛЯ ЗАЩИТЫ (DEMO)

Для успешной защиты подготовить 3 файла:

1.  **"Звезда" (Green Zone):**
    *   *Кейс:* Опытный, живет рядом.
    *   *Результат:* Score > 85%, Риск: Низкий.
2.  **"Рискованный" (Red Zone):**
    *   *Кейс:* Далеко ехать, не подходят смены.
    *   *Результат:* Score < 40%, Риск: Высокий.
    *   *UI:* Показывает "Причина риска: Логистика".
3.  **"Edge Case" (Yellow Zone):**
    *   *Кейс:* Неполные данные (не назвал опыт).
    *   *Результат:* Система не падает, ставит дефолтное значение и помечает запись флагом "Требует уточнения".

## 7. ТЕХНОЛОГИЧЕСКИЙ СТЕК
*   **Backend (Тихон):** FastAPI, SQLModel (SQLite/PG).
*   **AI (Андрей):** OpenAI API (GPT-4o-mini), Whisper.
*   **ML/UI (Арсений):** Scikit-learn / CatBoost, Streamlit.